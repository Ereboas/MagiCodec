<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>MagiCodec - Demo & Benchmark </title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet"/>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
<link  href="https://cdn.datatables.net/2.0.5/css/dataTables.dataTables.min.css" rel="stylesheet"/>
<script src="https://cdn.datatables.net/2.0.5/js/dataTables.min.js"></script>
<script src="https://unpkg.com/wavesurfer.js@7"></script>

<style>
  :root{--bg:#f9f9fc;--fg:#111;--card:#fff;--radius:1rem;--cols-per-row:4;}
  html{background:var(--bg);color:var(--fg);font-family:"Segoe UI",Roboto,"PingFang SC",sans-serif;line-height:1.55;}
  body{margin:0;padding:3rem 8vw;display:flex;flex-direction:column;gap:3rem;max-width:1920px;}

  section.section-card{background:var(--card);border-radius:var(--radius);padding:1.5rem;box-shadow:0 4px 20px rgba(0,0,0,.05);}
  h2{margin:0 0 1rem;font-weight:600;}
  .section-card p {
    line-height: 1.8;       
    margin-bottom: 1.2em;   
    font-size: 1.06em;      
  }

  /* Listening Examples */
  #examples-grid{display:flex;flex-direction:column;gap:2rem;}
  .sample-card{padding:1rem;border:1px solid #ddd;border-radius:var(--radius);}
  .sample-text{margin:.25rem 0 1rem;font-weight:500;}
  .tracks{display:grid;gap:.75rem;grid-template-columns:repeat(var(--cols-per-row),1fr);}
  .track{background:#f2f4ff;border-radius:12px;padding:.6rem .9rem;min-width:0;}
  .track h4{margin:0 0 .8rem;font-size:.9rem;font-weight:600;}

  .player-controls{display:flex;justify-content:space-between;align-items:center;margin-bottom:.4rem;}
  .player-controls button{width:34px;height:34px;padding:0;font-size:1.1rem;}

  /* Benchmark */
  .dataTables_wrapper{overflow-x:auto;}
  #benchmark-table th,#benchmark-table td{text-align:center;}
  table.dataTable thead tr:first-child th,
  .fixedHeader-floating table thead tr:first-child th{text-align:center!important;}
  #benchmark-table thead th:nth-child(odd),#benchmark-table tbody td:nth-child(odd){background:#fcfcff;}
  #benchmark-table thead th:nth-child(even),#benchmark-table tbody td:nth-child(even){background:#f6f6ff;}
  #benchmark-table .leftcol{text-align:left!important;}
</style>
</head>

<body>

<header class="mb-3">
  <h1 class="display-4 fw-bold">Magicodec <span class="fs-4 text-muted"> - Demo & Benchmark </span></h1>
  <p class="lead">Simple <span style="border:1.5px solid #333; padding:1px 1px;">Ma</span>sked <span style="border:1.5px solid #333; padding:1px 1px;">G</span>aussian-<span style="border:1.5px solid #333; padding:1px 1px;">I</span>njected Audio <span style="border:1.5px solid #333; padding:1px 1px;">Codec</span> for High-Fidelity Reconstruction & Generation</p>
  <p>
    <a class="btn btn-outline-primary btn-sm me-2" href="https://arxiv.org/abs/2506.00385" target="_blank">üìÑ Paper</a>
    <a class="btn btn-outline-success btn-sm me-2" href="https://huggingface.co/Ereboas/MagiCodec_16k_50hz" target="_blank">ü§ó Model</a>
    <a class="btn btn-outline-dark btn-sm"   href="https://github.com/Ereboas/MagiCodec" target="_blank">üêô GitHub</a>
  </p>
</header>

<section class="section-card" id="abstract">
  <h2>Abstract</h2>
  <p>
    Neural audio codecs have made significant strides in efficiently mapping raw audio waveforms into discrete token representations, which are foundational for contemporary audio generative models. 
    However, most existing codecs are optimized primarily for reconstruction quality, often at the expense of the downstream modelability of the encoded tokens.
    Motivated by the need to overcome this bottleneck, we introduce MagiCodec, a novel single-layer, streaming Transformer-based audio codec. 
    MagiCodec is designed with a multistage training pipeline that incorporates Gaussian noise injection and latent regularization, explicitly targeting the enhancement of semantic expressiveness in the generated codes while preserving high reconstruction fidelity.
    We analytically derive the effect of noise injection in the frequency domain, demonstrating its efficacy in attenuating high-frequency components and fostering robust tokenization. 
    Extensive experimental evaluations show that MagiCodec surpasses state-of-the-art codecs in both reconstruction quality and downstream tasks. 
    Notably, the tokens produced by MagiCodec exhibit Zipf-like distributions, as observed in natural languages, thereby improving compatibility with language-model-based generative architectures.
  </p>
</section>

<section class="section-card" id="examples">
  <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap">
    <h2 class="m-0">Listening&nbsp;Examples</h2>
    <label class="d-flex align-items-center ms-auto mb-2 mb-md-0">
      <span class="me-2">Audio&nbsp;per&nbsp;row:</span>
      <select id="cols-selector" class="form-select form-select-sm" style="width:auto;">
        <option>2</option><option>3</option><option selected>4</option><option>5</option><option>6</option>
      </select>
    </label>
  </div>
  <div id="examples-grid"></div>
</section>

<section class="section-card" id="benchmark">
  <h2>Benchmark</h2>
  <p class="text-muted small mb-3">Comparative scores on LibriSpeech test-clean set. ‚Üì = lower is better, ‚Üë = higher is better.</p>
  <p class="text-muted small mb-3">* indicates results from the <a href="https://arxiv.org/abs/2411.18803" target="_blank" rel="noopener noreferrer">TS3-Codec</a> paper. BigCodec-S refers to the streaming version of BigCodec. </p>
  <div id="benchmark-container">Loading benchmark table‚Ä¶</div>
</section>


<script>
/* === samples === */
const samples = [
  {
    text : "",
    tracks : [
      {label:"GT",        url:"audio/gt/001.wav"},
      {label:"Encodec (150 tok/s, Streaming)",  url:"audio/encodec/001.wav"},
      {label:"Mimi (25 tok/s, Streaming)", url:"audio/mimi25/001.wav"},
      {label:"Mimi (50 tok/s, Streaming)", url:"audio/mimi50/001.wav"},
      {label:"Mimi (100 tok/s, Streaming)", url:"audio/mimi100/001.wav"},
      {label:"DAC (100 tok/s)",url:"audio/dac100/001.wav"},
      {label:"DAC (150 tok/s)",url:"audio/dac150/001.wav"},
      {label:"Vocos (150 tok/s, Streaming)",url:"audio/vocos/001.wav"},
      {label:"SNAC (82 tok/s, Streaming)",url:"audio/snac/001.wav"},
      {label:"BigCodec(80 tok/s)",url:"audio/bigcodec/001.wav"},
      {label:"WavTokenizer (40 tok/s)",url:"audio/wavtokenizer40/001.wav"},
      {label:"WavTokenizer (75 tok/s)",url:"audio/wavtokenizer75/001.wav"},
      {label:"SpeechTokenizer (100 tok/s)",url:"audio/speechtokenizer/001.wav"},
      {label:"SemantiCodec (25 tok/s)",url:"audio/speechtokenizer25/001.wav"},
      {label:"SemantiCodec (50 tok/s)",url:"audio/speechtokenizer50/001.wav"},
      {label:"SemantiCodec (100 tok/s)",url:"audio/speechtokenizer100/001.wav"},
      {label:"MagiCodec (25 tok/s, Streaming)",url:"audio/magicodec25/001.wav"},
      {label:"MagiCodec (50 tok/s, Streaming)",url:"audio/magicodec50/001.wav"},
      {label:"MagiCodec (100 tok/s, Streaming)",url:"audio/magicodec100/001.wav"},
    ]
  },
];


function makeWave(div,url){
  const ws=WaveSurfer.create({
    container:div,height:54,barWidth:2,barGap:2,waveColor:"#d0d0d0",progressColor:"#4064ff"
  });
  ws.load(url);return ws;
}
const fmt=t=>{const m=Math.floor(t/60),s=Math.floor(t%60).toString().padStart(2,"0");return `${m}:${s}`};

/* === render === */
function renderExamples(){
  const grid=document.getElementById("examples-grid");grid.innerHTML="";
  samples.forEach((s,i)=>{
    const card=document.createElement("div");card.className="sample-card";
    card.innerHTML=`<p class="sample-text">${i+1}. ${s.text}</p>`;
    const wrap=document.createElement("div");wrap.className="tracks";
    s.tracks.forEach(t=>{
      const cell=document.createElement("div");cell.className="track";
      cell.innerHTML=`
        <h4>${t.label}</h4>
        <div class="player-controls">
          <button class="btn btn-outline-secondary btn-sm play-btn"><i class="bi bi-play-fill"></i></button>
          <input type="range" class="form-range volume-slider" min="0" max="1" step="0.05" value="1" style="width:90px;">
        </div>
        <div class="wave"></div>
        <div class="time text-muted small text-end mt-1">0:00 / 0:00</div>`;
      const ws=makeWave(cell.querySelector(".wave"),t.url);

      const btn=cell.querySelector(".play-btn");
      const timeEl=cell.querySelector(".time");
      const setIcon=p=>btn.innerHTML=`<i class="bi ${p?'bi-pause-fill':'bi-play-fill'}"></i>`;
      const updateTime=()=>timeEl.textContent=`${fmt(ws.getCurrentTime())} / ${fmt(ws.getDuration())}`;

      btn.onclick=()=>ws.playPause();
      ws.on("play",()=>setIcon(true));
      ws.on("pause",()=>setIcon(false));
      ws.on("finish",()=>{setIcon(false);updateTime();});
      ws.on("ready",updateTime);
      ws.on("audioprocess",updateTime);
      ws.on("seek",updateTime);

      cell.querySelector(".volume-slider").oninput=e=>ws.setVolume(+e.target.value);
      wrap.appendChild(cell);
    });
    card.appendChild(wrap);grid.appendChild(card);
  });
}
renderExamples();

/* column selector */
document.getElementById("cols-selector").addEventListener("change",e=>{
  document.documentElement.style.setProperty("--cols-per-row",e.target.value);
});

/* benchmark */
fetch("benchmark.html").then(r=>r.text()).then(html=>{
  document.getElementById("benchmark-container").innerHTML=html;
  const dt=new DataTable("#benchmark-table",{
    scrollX:true,
    fixedHeader:{header:true,headerOffset:0},
    stripeClasses:[]
  });
  const leftCols=["model","tag"];
  document.querySelectorAll("#benchmark-table thead tr:last-child th").forEach((th,i)=>{
    if(leftCols.includes(th.textContent.trim().toLowerCase())){
      th.classList.add("leftcol");
      document.querySelectorAll(`#benchmark-table tbody td:nth-child(${i+1})`).forEach(td=>td.classList.add("leftcol"));
    }
  });
}).catch(err=>{
  document.getElementById("benchmark-container").textContent="‚ö†Ô∏è Failed to load benchmark.html: "+err;
});
</script>
</body>
</html>
